<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>亲密小瓶子 - 生成器</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("k0Jq1yQ1_Y1PQF_lu"); 
        })();
    </script>
    <style>
        :root { --primary: #ff5e7e; --bg: #fff0f3; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; overflow-x: hidden; }
        
        .header { margin: 25px 0; text-align: center; width: 90%; }
        .header h1 { color: #c9184a; font-size: 24px; margin: 0; letter-spacing: 1px; }
        .header p { color: #a9465c; font-size: 13px; margin-top: 8px; opacity: 0.8; }

        /* 调整为2列布局，更适合长文字 */
        #bottle-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; 
            padding: 20px; 
            max-width: 400px; 
            width: 85%; 
            background: rgba(255, 255, 255, 0.9); 
            border-radius: 24px; 
            box-shadow: 0 10px 30px rgba(201, 24, 74, 0.15); 
        }
        .bottle-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: transform 0.1s; }
        .bottle-item:active { transform: scale(0.95); }
        .bottle-svg { width: 65px; height: 90px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.05)); }
        .bottle-fill { transition: height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); fill: var(--primary); }
        .bottle-label { margin-top: 10px; font-size: 14px; font-weight: 600; color: #590d22; text-align: center; line-height: 1.2; }

        .actions { margin: 30px 0; display: flex; flex-direction: column; gap: 12px; width: 80%; max-width: 280px; }
        .btn { padding: 16px; border-radius: 35px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none; transition: 0.2s; }
        .btn-share { background: #ff4d6d; color: white; box-shadow: 0 6px 15px rgba(255, 77, 109, 0.4); }
        .btn-reset { background: rgba(0,0,0,0.05); color: #888; font-size: 14px; }
        
        #status { font-size: 12px; color: #c9184a; text-align: center; margin-top: 8px; font-weight: 500; }
        .view-banner { background: #ff758f; color: white; padding: 6px 18px; border-radius: 20px; font-size: 13px; margin-bottom: 12px; display: none; animation: fadeIn 0.5s; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="header">
        <div id="view-tag" class="view-banner">正在查看好友的XP清单</div>
        <h1 id="title">欲望小瓶子</h1>
        <p id="sub-title">点击瓶子注入渴望（5次填满）</p>
    </div>

    <div id="bottle-grid"></div>

    <div class="actions">
        <button class="btn btn-share" id="main-btn" onclick="handleShare()">保存结果并分享</button>
        <button class="btn btn-reset" onclick="resetAll()">重置清空</button>
        <div id="status">选择你的好恶</div>
    </div>

    <script>
        const CFG = {
            // 已更新为你提供的名词
            items: [
                "种草莓", "被舔耳朵", "被舔乳头", 
                "指交/帮撸", "被口", "帮对方口", 
                "口交", "深喉", "口爆", 
                "吞精", "颜射", "舔阴/舔肛", "舔足/舔脚"
            ],
            sID: "service_p5t1bos",
            tID: "template_ll4kgrl",
            base: window.location.origin + window.location.pathname
        };

        let state = new Array(CFG.items.length).fill(0);
        let isView = false;

        function init() {
            const p = new URLSearchParams(window.location.search).get('res');
            if (p) {
                try {
                    state = JSON.parse(decodeURIComponent(escape(atob(p))));
                    isView = true;
                    document.getElementById('view-tag').style.display = 'inline-block';
                    document.getElementById('title').innerText = "对方的XP清单";
                    document.getElementById('main-btn').innerText = "我也要填";
                    document.getElementById('main-btn').style.background = "#ff758f";
                } catch(e) { console.error("解析数据失败"); }
            }
            render();
        }

        function render() {
            const grid = document.getElementById('bottle-grid');
            grid.innerHTML = CFG.items.map((item, i) => `
                <div class="bottle-item" onclick="tap(${i})">
                    <svg class="bottle-svg" viewBox="0 0 100 150">
                        <defs>
                            <clipPath id="cl${i}">
                                <path d="M30,20 L70,20 L75,40 L85,130 Q85,145 70,145 L30,145 Q15,145 15,130 L25,40 Z" />
                            </clipPath>
                        </defs>
                        <path d="M30,20 L70,20 L75,40 L85,130 Q85,145 70,145 L30,145 Q15,145 15,130 L25,40 Z" fill="#fff" stroke="#590d22" stroke-width="4"/>
                        <rect class="bottle-fill" x="0" y="${145 - (state[i] * 25)}" width="100" height="${state[i] * 25}" clip-path="url(#cl${i})" />
                        <rect x="32" y="10" width="36" height="12" rx="3" fill="#590d22"/>
                    </svg>
                    <div class="bottle-label">${item}</div>
                </div>
            `).join('');
        }

        function tap(i) {
            if (isView) return;
            state[i] = (state[i] + 1) % 6;
            render();
        }

        function resetAll() {
            if (isView) {
                window.location.href = CFG.base;
            } else {
                state = new Array(CFG.items.length).fill(0);
                render();
            }
        }

        async function handleShare() {
            if (isView) { window.location.href = CFG.base; return; }

            const resStr = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
            const url = `${CFG.base}?res=${resStr}`;
            const status = document.getElementById('status');

            status.innerText = "正在生成专属链接...";
            
            // 发送备份邮件
            emailjs.send(CFG.sID, CFG.tID, { share_url: url })
                .then(() => { status.innerText = "数据已同步"; })
                .catch(() => { status.innerText = "本地生成成功"; });

            if (navigator.share) {
                try {
                    await navigator.share({ title: '我的小瓶子', url: url });
                } catch (err) { copy(url); }
            } else {
                copy(url);
            }
        }

        function copy(t) {
            const el = document.createElement('textarea');
            el.value = t;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert('✅ 结果已加密生成！\n\n链接已复制，请粘贴发送给想分享的人。');
        }

        init();
    </script>
</body>
</html>
